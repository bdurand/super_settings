services:
  redis:
    image: redis:7-alpine
    volumes:
      - type: volume
        source: redis_data
        target: /data
        volume:
          nocopy: true
    command: ["redis-server", "--maxmemory", "20m", "--maxmemory-policy", "allkeys-lru", "--appendonly", "yes", "--databases", "2"]
    ports:
      - target: 6379
        published: ${REDIS_PORT:-6379}
        protocol: tcp
        mode: host

  minio:
    image: minio/minio:RELEASE.2024-09-22T00-33-43Z
    environment:
      MINIO_ROOT_USER: accesskey
      MINIO_ROOT_PASSWORD: secretkey
    command: server /data
    volumes:
      - type: volume
        source: minio_data
        target: /data
        volume:
          nocopy: true
    ports:
      - target: 9000
        published: ${S3_PORT:-9000}
        protocol: tcp
        mode: host

volumes:
  redis_data:
    driver: local
  minio_data:
    driver: local
